<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log in</title>
    <link rel="stylesheet" href="assets/style.css">
</head>

<body>

    <div class="container" id="fondo">
        <div class="bienvenida">
            <div class="image" >
                <figure class="imagen" id="logo" >
                    <img src="../login-regis/assets/logo.jpg">
                 </figure>
            </div>
        </div>
        <div class ="formulario" id="form">
            <h1>Inicio</h1><p> ¡Bienvenido! Ingrese su usuario antes de comenzar a jugar.</p>
            <form method="post">
                <div class="campos">
                    <input type="text" id="nombre" required placeholder="usuario">
                </div>
                <div id="mensaje_error">
                    No se encontró el usuario
                </div>
                <div class="boton">
                    <button type="submit">Iniciar sesion</button>
                </div>
                <div class="registrarse">
                    <p>Si no tenés usuario registrate acá <a href="pag-registro/index.html">Registrarse</a></p>
                </div>
            </form>
        </div>
        

        <script>

        
        document.getElementById("form").addEventListener("submit", async (e) => {
            e.preventDefault();

            const divError=document.getElementById("mensaje_error");

            const nombre=document.getElementById("nombre").value.trim();

            if(!nombre){
                divError.text,content="El usuario no se encontró"
                divError.style.display="block";
                return;
            }
            
            try {
                const response= await fetch(`https://quiz-city-back-despliegue.onrender.com/api/usuarios/${encodeURIComponent(nombre)}`)

                    

                if (!response.ok) {
                    divError.text,content="El usuario no se encontró"
                    divError.style.display="block";
                    return;
                    }

                    const usuario= await response.json();
                    const secret = "echo_boca";
                    const token = btoa(usuario.usuario + ":" + secret)

                    localStorage.setItem("usuario", JSON.stringify(usuario));
                    localStorage.setItem("token", token)

                    window.location.href="../menu/index.html";
            }catch(error){
                console.error("Error al buscar usuario",error);
                divError.text.content="No se pudo conectar con el servidor"
                divError.style.display="block";
                console.log(divError);
            }

        });


        </script>
 </div>

</body>
</html>
