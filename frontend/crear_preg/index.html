<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css">
    <link rel="stylesheet" href="assets/style_crearpre.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <title>Crear Pregunta</title>
</head>

<body>
    <div class="container" id="fondo">
        <a class="button is-dark is-small" id="boton_menu" href="../menu/index.html">
            <span class="icon">
                <i class="fas fa-home"></i>
            </span>
            <span>MENU</span>
        </a>

        <div class="box" >
            <div class="Gracias">
                <h1 class="title is-2 has-text-centered">¡Gracias por contribuir con el juego!</h1>
                <p class="subtitle is-">Completa los siguientes campos para que tu pregunta esté disponible para todos los jugadores</p>
            </div>
            <div class="field" >
                <label class="label">Pregunta:</label>
                <div class="control">
                    <input class="input" type="text" id="pregunta" required placeholder="Tu pregunta..." />
                </div>
            </div>

            <div class="field has-addions" >
                <label class="label">Categoria</label>
            <div class="control">
                <span class="select" id="selector_categoria">
                <select>
                    <option> Categoria </option>
                    <option> Deportes </option>
                    <option> Mundi </option>
                    <option> Cine </option>
                    <option> Mega-Mix </option>
                </select>
                </span>
            </div>
            </div>

            <div class="field has-addions" >
                <label class="label">Dificultad</label>
            <div class="control">
                <span class="select" id="selector_dificultad">
                <select>
                    <option> Dificultad </option>
                    <option> Facil </option>
                    <option> Intermedio </option>
                    <option> Dificil </option>
                </select>
                </span>
            </div>
            </div>

            <div class="field">
                <label class="label">Opción Correcta</label>
                <!-- <div class="control">
                    <input class="input" type="text" id="respuesta_correcta" required placeholder="Opcion Correcta" />
                </div> -->
                <div class="field has-addions" >
                    <div class="control">
                        <span class="select" id="respuesta_correcta">
                            <select>
                                <option> Opciones </option>
                                <option value="a"> A </option>
                                <option value="b"> B </option>
                                <option value="c"> C </option>
                            </select>
                        </span>
                    </div>
                </div>
            </div>

            <div class="field">
                <label class="label">Opcion A:</label>
                <div class="control">
                    <input class="input" type="text" id="respuesta_a"required placeholder="Opcion A" />
                </div>
            </div>

            <div class="field">
                <label class="label">Opcion B:</label>
                <div class="control">
                    <input class="input" type="text" id="respuesta_b" required placeholder="Opcion B" />
                </div>
            </div>

            <div class="field">
                <label class="label">Opcion C:</label>
                <div class="control">
                    <input class="input" type="text" id="respuesta_c" required placeholder="Opcion C" />
                </div>
            </div>

            <div class="notification is-warning is-light" id="mensaje_completar_datos">
                Por favor, ingrese todos los datos.
            </div>
            <button class="button is-primary" id="boton_envio">Guardar pregunta</button>
        </div>
    </div>

    <script>
        const usuarioGuardado = JSON.parse(localStorage.getItem("usuario"))
        const secret = "echo_boca";
		const token = localStorage.getItem("token");
		if (!usuarioGuardado || !token) {
			// Redirige al login si falta algo 
			alert("No has iniciado sesion")
			window.location.href = "../login-regis/index.html";
		} else {
			const expectedToken = btoa(usuarioGuardado.usuario + ":" + secret);
			console.log(expectedToken)
			if (token !== expectedToken) {
				// Token inválido, redirige al login
				alert("No has iniciado sesion")
				window.location.href = "../login-regis/index.html";
			}
        }	  
        const mensaje=document.getElementById("mensaje_completar_datos");
        mensaje.style.display="none";

    document.getElementById("boton_envio").addEventListener("click", async function() {

        const pregunta = document.getElementById("pregunta").value.trim();
        const categoria = document.querySelector("#selector_categoria select").value.trim();
        const dificultad= document.querySelector("#selector_dificultad select").value.trim();
        const respuesta_correcta = document.querySelector("#respuesta_correcta select").value.trim();
        const respuesta_a = document.getElementById("respuesta_a").value.trim();
        const respuesta_b = document.getElementById("respuesta_b").value.trim();
        const respuesta_c = document.getElementById("respuesta_c").value.trim();

        if(!pregunta || categoria === "Categoria" || dificultad === "Dificultad" || respuesta_correcta === "Opciones" || !respuesta_correcta || !respuesta_a || !respuesta_b || !respuesta_c ){
            mensaje.style.display="block";
            return;
        }
        mensaje.style.display="none";


        let puntos= 0;
        
        if(dificultad === "Facil"){
            puntos=10;
        }
        else {
            if(dificultad === "Intermedio" ){
                puntos=20;
            }
            else{
                puntos=30;
            }
        }

            try{
                const response= await fetch("http://localhost:3030/api/preguntas",{

                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        pregunta: pregunta,
                        categoria: categoria,
                        dificultad: dificultad,
                        puntos: puntos,
                        id_usuario: usuarioGuardado.id,
                        respuesta_a: respuesta_a,
                        respuesta_b: respuesta_b,
                        respuesta_c: respuesta_c,
                        respuesta_correcta: respuesta_correcta
                    })
                })
                if (response.ok){
                    alert("¡Pregunta guardada con éxito!");
                    document.querySelector("form")?.reset();
                }else{
                    alert("No se pudo guardar la pregunta");
                }
               
            }catch(error){
                alert("error al guardar la pregunta");
                console.error(error);
            }
        });
    </script>


</body>
</html>